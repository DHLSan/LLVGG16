
#include <stdio.h>
#include "platform.h"
#include "xil_printf.h"
#include <xtime_l.h>

float mem[1000]={0,0.559065,0,0,0,0,0,1.87219,0.514628,0,0,0,1.14587,0,0,0.934227,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0880255,0,0,0,1.38548,0,1.12436,0,0,0.219216,0,0.983779,0,0,0.406663,0,0,0,0,0.888134,0.384107,0,0,0,0,0,2.51277,0.0044193,0.500612,0,0,0,0,0,0,0,0,0,0,1.2588,0,0,1.43368,0.286313,0,0,0.416798,0,0,0,0.0748549,0,0,0,1.12004,0,0,0,0,0,0,0,0,0,1.44075,0,1.05252,0,0,0,0,0,0.97302,0,0.567319,0,0,0,0.536256,0,0,0,0.424058,0,0.582596,0.0875918,0,0,0,0,0,0,0,0.411623,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2.14344,0,0,0,0,0,0,0,0,0,0,0,0,0.34623,0,0,0,1.36125,0,0,0.224682,0,0.671723,0.551591,0.72177,0,0,0.268646,0,0,0,0.592367,0,0.180897,1.79917,4.59667,2.44031,0,0.296536,0,0.362141,0.46194,1.21499,0,0,0.226822,0,0,0.248393,0,1.87186,0.205569,0.223509,0,0,0,1.78885,0.121716,0,0,1.38568,0,0,0,0.0498308,0,0,0.0392056,0.0522457,0,0,0,0.491141,0.000895575,0,0,1.60429,0,0,0.127978,0.442091,1.11323,0.911065,0,1.89409,0,0,0,0,0,0,0,0,0,0,0,0,2.59272,1.40185,1.1307,0.33586,0,1.34019,0,0,0,0,0,0.598416,0.495669,0,0,1.30747,1.22262,0,0,0,0,2.0548,0.323387,1.42679,4.00346,1.27097,1.51095,0,3.44178,3.49645,3.29062,0,3.25094,11.0524,12.6393,4.39787,2.60635,12.7054,3.43726,8.64803,3.02872,2.70304,2.9121,2.66015,4.97088,4.62542,0,0,0,0,1.19939,2.23784,0,0,0,0,0,0,0,0,0,0,0,0.15688,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0289579,1.04803,0,0,0.946833,1.38534,1.44884,1.7139,0,0.973432,0,0,0,0,2.00542,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0769143,0,0,0,0,0,0,0,0.709678,0,0,0,0,0,0,0,0,0,0.50138,0,0,0,0.756835,0,0,0.32481,0,0,0.764459,0,0,0,1.24827,0,0,0,0,0,0,0,0,0,0,3.18753,0,0,0.357515,2.96521,0,0,0,0.592749,0,0,1.71315,0,0.440714,2.88428,0,1.47435,0,1.13024,0.801783,0.708741,1.18272,0.449515,0.27745,0.401653,0,0.349609,0,0.947122,1.24516,1.57177,2.27057,0,0,0,0.247031,1.85282,3.01783,0,0,1.91246,0,2.66781,3.11832,0,0.41123,0,0,1.71458,0,0,0,0,0,0.937215,3.34283,2.15657,2.05988,0.963486,3.56771,0,0,0,0,3.86739,3.31703,0.81701,0,0,0,0.604082,0.441438,2.67749,0,0.255246,1.00213,0,1.37327,0.101712,0.147308,4.6,1.22502,0.0852562,0,0,0,0,1.26167,0.302189,3.5566,0,0,0,0,0,0,0,0,1.67085,0,0,0.332544,0,0.692709,0.35748,0.686465,4.76301,0,0.457725,0,5.62106,0,0.0735064,0,0,0,3.50469,3.33301,0.481883,0,0.739332,3.59031,0.758366,3.40181,0,0,0,0,2.31485,3.83773,1.64299,0,3.17368,0.467192,1.73964,0.151269,3.0648,0,0,0,0,5.24605,0,0.754669,3.55752,3.28975,0,0,2.84085,0,0.588239,1.11157,0.855419,0.312691,3.00207,2.75815,0,0,0.281449,0,0.270039,0.556238,0,0,2.28664,1.37213,0.202937,0,0.416985,1.75303,2.12808,0,0,0,2.59114,0,0.53567,0,0,0,0,1.37629,0,0.548985,0.898189,0,0,1.11672,0,3.33907,3.07965,1.03219,0.68741,0,2.67914,1.71043,0.0551032,0,2.30773,0,1.11329,1.02973,0.67298,0,0.925313,0,1.80097,2.68808,3.19175,2.04,1.34774,0,0.461844,3.79396,0,1.73581,0.112958,0,1.01895,0,0.877651,1.42207,5.34512,0,5.9053,1.23941,1.6836,0,1.70016,0,0,2.52777,0,1.06138,0.153192,1.06442,0,0,1.19949,2.5811,1.15025,0.243833,0,1.49431,0.0562295,0.259539,2.2207,0,0.751657,1.99106,0.907583,0,1.13483,3.66594,0,0.147252,0,0.481027,0,0,2.57228,3.38636,0,0,1.1281,0,4.58973,0.97025,0.885128,0,0,0,2.20488,0,0,5.91093,1.92228,0,0.225571,0.157546,0,0,2.18373,5.57656,0.623885,0,0,0,0,0,2.5136,0,0,0,1.59476,0.375176,0,0,3.22202,2.17654,0,1.00601,2.58119,0,1.3279,1.42478,0,0,0.566043,0,0.639013,0.928723,1.19632,1.54272,0,2.08115,2.23866,0,0.991987,0,0,1.10839,2.04495,1.70414,6.07219,1.85369,0,3.52094,0,0,2.83426,0.682346,0,2.36946,0.821471,0,0,0,3.49598,2.12755,1.27777,0,2.04426,2.03762,3.02445,0,0,1.23917,0.659531,2.90697,0,0.31607,3.88173,0,1.10195,4.73336,2.50101,0,1.23949,0,0.558596,0.850663,3.98413,6.99926,1.16178,0.299217,0,2.51715,0,3.1706,0.679087,3.31266,2.84567,0,0.180921,2.50516,0.547291,0,0,0,4.32174,0,0,0,5.38044,2.36536,1.93521,0,2.22866,0.412793,0.863526,2.10387,1.53046,0.0692221,0.0159019,0.772144,1.77963,0.679132,0.927698,2.20515,1.82953,2.41948,0,0,0,0,1.90057,1.69876,4.34908,0,1.84916,3.32253,1.238,4.43182,0,2.66851,0,0,0.739108,0,1.4755,1.26014,0,0,0,1.13827,1.23165,0,0.194627,1.7148,0.499112,0,0,3.04602,0,0,0,1.74964,1.30888,1.75071,1.74991,0,3.52658,2.44304,0,0.997602,0.871925,2.95182,2.06346,0,0,0.960324,1.26568,3.89041,3.77341,0,2.31722,1.97584,0,0.476793,1.97301,1.99686,0.748751,1.80988,0.92006,0,0,0,0,0.620794,3.35184,0,0.94026,0,0.935318,0,0,0,3.15413,0,1.40389,1.24467,0.943745,0.623889,2.06379,2.86451,0,2.074,0.864426,0,0,1.98867,0,0.832396,2.53631,0.507546,1.55598,0,2.8825,3.20673,3.04243,2.32688,0,0,0.0458872,0.848602,5.56402,4.40467,0,2.38753,0,1.67112,3.00295,0,0,0,0,0,2.23655,1.68628,6.11697,0.602762,1.08878,2.1351,0.850329,1.17762,1.29577,0,0,0,0.552148,3.67367,0.107429,1.05144,0.825044,0,1.06036,0,0,2.33778,0,1.88357,0,0,2.15584,1.49963,0,1.2846,0,0,0.554328,0.751702,2.33996,0.246886,0,2.56362,2.6631,0,0,1.37702,3.72324,0.667861,0,1.49873,0,0.973929,0.895936,0.433286,3.80442,1.46758,4.8691,1.82614,0,1.57588,0,0,0,0,0,0,0,0,0,0.567171,0,0,0,0,0,5.17641,0,0,0.30508,0,0,0,0,0,0,0,4.12028,1.10799};

volatile int * soft_control = (volatile int *)(0x43C00000);
volatile float * soft_in =  (volatile float *)(0x43C11000);
volatile int * soft_out =     (volatile int *)(0x43C21000);
volatile float * soft_out1= (volatile float *)(0x43C22000);

XTime tStart1,tEnd1;
XTime tStart2,tEnd2;
int main()
{
	int i;
	int class[1000];
	float result[1000];
    init_platform();
    double ElapsedTime1,ElapsedTime2;


    for (int i = 0; i<1000;i++){
    		soft_in[i]= mem[i];

    		}

	soft_control[0] |=0x1;
	XTime_GetTime(&tStart1);
	while((soft_control[0]&0x2) != 0x2);

	XTime_GetTime(&tEnd1);

	for (int i=0; i<1000;i++){
		if(soft_out1[i]>=0.4){
				printf("class: %d\n",soft_out[i]);
				printf("result: %f\n",soft_out1[i]);
		}
			}

	ElapsedTime1 = 1.0*(tEnd1- tStart1)/(COUNTS_PER_SECOND);

	printf("Hardware clock cycle of Softmax IP : %lf \n", 1.0*(tEnd1- tStart1));
	printf("Hardware outputs of Softmax IP Took : %lf \n", ElapsedTime1);
	XTime_GetTime(&tStart2);
	int counter =0;
	float max_val, sum;
		max_val = mem[0];
		for (i = 1; i < 1000; i++) {
			if (mem[i] > max_val)
				max_val = mem[i];
		}
		sum = 0.0;
		for (i = 0; i < 1000; i++) {
			mem[i] = exp(mem[i] - max_val);
			sum += mem[i];
		}
		for (i = 0; i < 1000; i++) {
			mem[i] /= sum;
		}

	for (i = 0; i < 1000; i++) {

			if (mem[i]) {

				class[i] = counter;
				result[i] = mem[i];

			}

			counter = counter + 1;

	}
	XTime_GetTime(&tEnd2);
	ElapsedTime2 = 1.0*(tEnd2- tStart2)/(COUNTS_PER_SECOND);
	for (int i=0; i<1000;i++){
			if(result[i]>= 0.4){
					printf("class: %d\n",class[i]);
					printf("result: %f\n",result[i]);
			}
				}
	printf("Software clock cycle of Softmax function: %lf \n", 1.0*(tEnd2- tStart2));
	printf("Software outputs of Softmax function Took : %lf \n", ElapsedTime2);



    cleanup_platform();

    return 0;
}



